<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Admin Isolated</title>
  <style>
    /* Весь твой CSS оставлен без изменений */
    body {
      margin: 0;
      font-family: sans-serif;
      background-color: #0f0f0f;
      background-image: radial-gradient(#222 1px, transparent 1px);
      background-size: 20px 20px;
      overflow: hidden;
    }
    .menu {
      position: fixed;
      top: 20px;
      left: 20px;
      background: rgba(255,255,255,0.05);
      padding: 10px 20px;
      border-radius: 8px;
      font-size: 0.9em;
      color: #aaa;
      z-index: 3000;
      user-select: none;
    }
    .workspace {
      width: 100vw;
      min-height: 100vh;
      overflow-y: auto;
      position: relative;
    }
    .canvas {
      position: relative;
      top: 0;
      left: 0;
      transform-origin: top left;
      transition: transform 0.1s ease;
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 20px;
      padding: 100px 40px 200px 40px;
      width: 100%;
      box-sizing: border-box;
      min-height: 100vh;
    }
    .tile {
      border-radius: 12px;
      border: 4px solid transparent;
      transition: transform 0.2s ease, box-shadow 0.3s ease;
      background-color: #111;
      position: relative;
      cursor: move; /* меняем на move для админки */
      overflow: hidden;
      z-index: 1;
      will-change: transform;
    }
    .tile.dragging {
      transform: scale(1.05) translateY(-5px);
      box-shadow: 0 0 20px rgba(255, 255, 255, 0.3);
    }
    .tile img,
    .tile video {
      display: block;
      border-radius: 8px;
      pointer-events: none;
      width: 100%;
      height: 100%;
      object-fit: contain;
    }

    /* Кнопка сохранения layout */
    .admin-panel {
      position: fixed;
      top: 20px;
      right: 20px;
      z-index: 5000;
    }
    .admin-panel button {
      background: rgba(255,255,255,0.1);
      color: #fff;
      border: 1px solid #666;
      padding: 6px 12px;
      border-radius: 6px;
      cursor: pointer;
    }
  </style>
</head>
<body>

  <div class="menu">Admin Panel</div>
  <div class="admin-panel">
    <button id="saveLayout">Save Layout</button>
  </div>

  <div class="workspace">
    <div class="canvas" id="canvas"></div>
  </div>

  <script>
    /* Сохраняем все работы из index.html */
    const works = [
      { type: 'image', src: 'thumbs/image1.png' },
      { type: 'video', src: 'thumbs/balenciaga.mp4' },
      { type: 'video', src: 'thumbs/brds.mp4' },
      { type: 'image', src: 'thumbs/mkc.png' },
      { type: 'video', src: 'thumbs/sora11.mp4' }
    ];

    const canvas = document.getElementById('canvas');

    function buildTiles() {
      canvas.innerHTML = '';
      works.forEach(work => {
        const tile = document.createElement('div');
        tile.className = 'tile';
        tile.draggable = true;

        let content;
        if (work.type === 'image') {
          content = document.createElement('img');
          content.src = work.src;
        } else {
          content = document.createElement('video');
          content.src = work.src;
          content.autoplay = true;
          content.loop = true;
          content.muted = true;
        }
        tile.appendChild(content);
        canvas.appendChild(tile);
      });
      addDnDHandlers();
    }

    function addDnDHandlers() {
      let dragSrc = null;
      document.querySelectorAll('.tile').forEach(tile => {
        tile.addEventListener('dragstart', e => {
          dragSrc = tile;
          tile.classList.add('dragging');
          e.dataTransfer.effectAllowed = 'move';
        });
        tile.addEventListener('dragover', e => {
          e.preventDefault();
          e.dataTransfer.dropEffect = 'move';
        });
        tile.addEventListener('drop', e => {
          e.preventDefault();
          if (dragSrc && dragSrc !== tile) {
            const srcHTML = dragSrc.outerHTML;
            dragSrc.outerHTML = tile.outerHTML;
            tile.outerHTML = srcHTML;
            addDnDHandlers();
          }
        });
        tile.addEventListener('dragend', () => {
          tile.classList.remove('dragging');
        });
      });
    }

    document.getElementById('saveLayout').addEventListener('click', () => {
      const tiles = document.querySelectorAll('.tile img, .tile video');
      const layout = [];
      tiles.forEach((el, idx) => {
        layout.push({ order: idx, type: el.tagName.toLowerCase(), src: el.getAttribute('src') });
      });
      const blob = new Blob([JSON.stringify(layout, null, 2)], {type: "application/json"});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = "positions.json";
      a.click();
      URL.revokeObjectURL(url);
    });

    buildTiles();
  </script>

</body>
</html>
